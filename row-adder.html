<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icons/editor-icons.html">
<link rel="import" href="../property-editor/property-editor.html">


<dom-module id="row-adder">
    <style is="custom-style">
        :host {
            --grid-column-start: 1;
            --grid-column-end: 1;
            --grid-row-start: 1;
            --grid-row-end: 1;

            display: block;
            position: relative;
            grid-column-start: var(--grid-column-start);
            grid-column-end: var(--grid-column-end);
            grid-row-start: var(--grid-row-start);
            grid-row-end: var(--grid-row-end);
        }

        .settings {
            position: absolute;
            top: 0px;
            right: 0px;
            height: auto;
            background: rgba(0, 0, 0, 0.2);

        }
        .settings-icon {
            color: rgba(0, 0, 0, 0.4);
            --iron-icon-height: 15px;
            --iron-icon-width: 15px;
            cursor: pointer;
            margin: 5px;
        }

        .properties-group {
            border: 1px solid rgba(0, 0, 0, 0.1);
            padding: 5px;
        }

        .show-controls {
            display: block;
        }

        input {
            width: 20px;
        }
        .controls .properties-group > h5 {
            margin: 0;
        }
        .controls .properties-group > p {
            margin: 0;
            font-size: 12px;
            padding-left: 10px;
        }
    </style>
    <template>
        <template is="dom-if" if="[[inEditMode]]">
            <div class="settings">
                <iron-icon class="settings-icon" icon="editor:mode-edit" on-click="openProperties"></iron-icon>
                <iron-icon class="settings-icon" icon="icons:content-copy" on-click="copyRowAdder"></iron-icon>
                <iron-icon class="settings-icon" icon="icons:content-cut" on-click="cutRowAdder"></iron-icon>
                <iron-icon class="settings-icon" icon="icons:content-paste" on-click="pasteRowAdder"></iron-icon>
            </div>
            <paper-dialog class="properties-dialog">
                <h2>Properies for "[[elName]]" component.</h2>
                <paper-dialog-scrollable>
                    <div class="controls">
                        <template is="dom-repeat" items="[[componentProperties]]">
                            <div class="properties-group">
                                <h5>[[item.name]]</h5>
                                <template is="dom-repeat" items="[[item.value]]">
                                    <property-editor data$=[[item]]></property-editor>
                                </template>
                            </div>
                        </template>
                    </div>
                </paper-dialog-scrollable>
                <div class="buttons">
                    <paper-button dialog-dismiss>Cancel</paper-button>
                    <paper-button dialog-confirm autofocus on-click="saveAndClose">Save and Close</paper-button>
                </div>
            </paper-dialog>
        </template>
    </template>
    <script>
        Polymer({
            is: 'row-adder',

            properties: {
                elName: {
                    type: String,
                    reflectToAttribute: true,
                    notify: true,
                    value: ''
                },

                inEditMode: {
                    type: Boolean,
                    reflectToAttribute: true,
                    notify: true
                },
                componentProperties: {
                    type: Object,
                    reflectToAttribute: true,
                    notify: true
                }
            },

            ready: function() {
                var el = document.createElement(this.elName);

                // add properties to the created element
                for(var i = 0; i < this.componentProperties.length; i++) {
                    if(this.componentProperties[i].name == 'componentProperties') {
                        var data = this.componentProperties[i].value;
                        for(var j = 0; j < data.length; j++) {
                            el.setAttribute(this.toPascalCase(data[j].name), data[j].value);
                        }
                    }
                    if(this.componentProperties[i].name == 'display') {
                        var data = this.componentProperties[i].value;
                        for(var j = 0; j < data.length; j++) {
                            var prop = '--' + this.toPascalCase(data[j].name);
                            this.customStyle[prop] = '' + data[j].value;
                        }
                        this.updateStyles();
                    }
                }

                if(this.inEditMode) {
                    el.setAttribute('in-edit-mode', this.inEditMode);
                }
                this.appendChild(el);
            },

            toPascalCase: function(s) {
                return s.replace(/\.?([A-Z])/g, function (x,y) {
                    return "-" + y.toLowerCase();
                }).replace(/^_/, "");
            },

            openProperties: function() {
                this.$$('.properties-dialog').open();
            },

            copyRowAdder: function() {

            },

            cutRowAdder: function() {

            },

            pasteRowAdder: function() {

            },

            saveAndClose: function() {
                this.fire('component-modified');
            }
        });
    </script>
</dom-module>